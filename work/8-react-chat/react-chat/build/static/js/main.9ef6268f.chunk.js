(this["webpackJsonpreact-chat"]=this["webpackJsonpreact-chat"]||[]).push([[0],{10:function(e,t,n){},11:function(e,t,n){},12:function(e,t,n){"use strict";n.r(t);var s=n(0),r=n(1),c=n.n(r),i=n(4),a=n.n(i),o=(n(10),n(2)),u={"username-invalid":"The username you entered is invalid"},j=function(e){var t=Object(r.useState)(""),n=Object(o.a)(t,2),c=n[0],i=n[1],a=Object(r.useState)(!0),j=Object(o.a)(a,2),l=j[0],d=j[1],h=Object(r.useState)(!1),m=Object(o.a)(h,2),f=m[0],b=m[1],g=Object(r.useState)(""),O=Object(o.a)(g,2),p=O[0],x=O[1];return Object(s.jsxs)("div",{className:"login-panel",children:[p&&Object(s.jsx)("div",{class:"status",children:p}),Object(s.jsxs)("label",{children:["Username:",Object(s.jsx)("input",{disabled:f,onChange:function(e){x(""),i(e.target.value),d(!e.target.value)},value:c})]}),Object(s.jsx)("button",{onClick:function(){b(!0),function(e){var t=e.username;return fetch("/api/session",{method:"POST",headers:new Headers({"content-type":"application/json"}),body:JSON.stringify({username:t})}).catch((function(){return Promise.reject({error:"network-error"})})).then((function(e){return e.ok?e.json():e.json().then((function(e){return Promise.reject(e)}))}))}({username:c}).then((function(t){e.onLogin({username:c}),x(""),b(!1),e.setUsers(t)})).catch((function(e){i(""),x(u[e]),b(!1)}))},disabled:l||f,children:f?"...":"Login"})]})},l=function(e){var t=Object(r.useState)(""),n=Object(o.a)(t,2),c=n[0],i=n[1],a=Object(r.useState)(!0),u=Object(o.a)(a,2),j=u[0],l=u[1],d=Object(r.useState)(!1),h=Object(o.a)(d,2),m=h[0],f=h[1];return Object(s.jsxs)("div",{className:"outgoing",children:[Object(s.jsx)("input",{disabled:m,onChange:function(e){i(e.target.value),l(!e.target.value)},value:c,placeholder:"Enter message to send"}),Object(s.jsx)("button",{onClick:function(){f(!0),function(e){var t=e.text;return fetch("/api/messages",{method:"POST",headers:new Headers({"content-type":"application/json"}),body:JSON.stringify({text:t})}).catch((function(){return Promise.reject({error:"network-error"})})).then((function(e){return e.ok?e.json():e.json().then((function(e){return Promise.reject(e)}))}))}({text:c}).then((function(t){f(!1),i(""),e.setMessages(t)})).catch((function(e){console.error("ERROR adding new message",e),f(!1)}))},disabled:j,children:"Send"}),Object(s.jsx)("button",{className:"logout",onClick:function(){fetch("/api/session",{method:"DELETE"}).catch((function(){return Promise.reject({error:"network-error"})})).then((function(e){return e.ok?e.json():e.json().then((function(e){return Promise.reject(e)}))})).then((function(t){e.onLogout(t)})).catch((function(e){console.error("ERROR logging out",e)}))},children:"Logout"})]})};n(11);var d=function(){var e=Object(r.useState)({isLoggedIn:!1,isPending:!0}),t=Object(o.a)(e,2),n=t[0],c=t[1],i=Object(r.useState)([]),a=Object(o.a)(i,2),u=a[0],d=a[1],h=Object(r.useState)({}),m=Object(o.a)(h,2),f=m[0],b=m[1];Object(r.useEffect)((function(){Promise.allSettled([fetch("/api/users",{method:"GET"}).catch((function(){return Promise.reject({error:"network-error"})})).then((function(e){return e.ok?e.json():e.json().then((function(e){return Promise.reject(e)}))})),fetch("/api/messages",{method:"GET"}).catch((function(){return Promise.reject({error:"network-error"})})).then((function(e){return e.ok?e.json():e.json().then((function(e){return Promise.reject(e)}))})),fetch("/api/session",{method:"GET"}).catch((function(){return Promise.reject({error:"network-error"})})).then((function(e){return e.ok?e.json():e.json().then((function(e){return Promise.reject(e)}))}))]).then((function(e){"fulfilled"===e[0].status&&b(e[0].value),"fulfilled"===e[1].status&&d(e[1].value),"fulfilled"===e[2].status?c({isLoggedIn:!0,isPending:!1,username:e[2].value.username}):c({isLoggedIn:!1,isPending:!1})}))}),[]);var g=function(e){var t=e.username;c({isLoggedIn:!0,isPending:!1,username:t})},O=function(e){c({isLoggedIn:!1,isPending:!1}),b(e)};return n.isPending?Object(s.jsx)("div",{className:"app",children:"Loading..."}):Object(s.jsxs)("div",{id:"chat-app",children:[Object(s.jsxs)("div",{className:"display-panel",children:[Object(s.jsx)("ul",{className:"users",children:Object.values(f).map((function(e){return Object(s.jsx)("li",{children:Object(s.jsx)("div",{className:"user",children:Object(s.jsx)("span",{className:"username",children:e.username})})},e.username)}))}),Object(s.jsx)("ol",{className:"messages",children:u.map((function(e,t){return Object(s.jsx)("li",{children:Object(s.jsxs)("div",{className:"message",children:[Object(s.jsxs)("div",{className:"meta-info",children:[Object(s.jsx)("div",{className:"sender-info",children:Object(s.jsx)("span",{className:"username",children:e.sender})}),Object(s.jsx)("div",{className:"message-info",children:Object(s.jsx)("span",{className:"timestamp",children:e.timestamp})})]}),Object(s.jsx)("p",{className:"message-text",children:e.text})]})},t)}))})]}),n.isLoggedIn?Object(s.jsx)(l,{username:n.username,onLogout:O,setMessages:d}):Object(s.jsx)(j,{onLogin:g,setUsers:b})]})},h=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,13)).then((function(t){var n=t.getCLS,s=t.getFID,r=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),s(e),r(e),c(e),i(e)}))};a.a.render(Object(s.jsx)(c.a.StrictMode,{children:Object(s.jsx)(d,{})}),document.getElementById("root")),h()}},[[12,1,2]]]);
//# sourceMappingURL=main.9ef6268f.chunk.js.map